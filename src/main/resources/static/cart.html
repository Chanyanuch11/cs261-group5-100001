<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="stylesheet.css" />
  <link rel="stylesheet" href="./cart.css" />
  <title>üõí My Cart</title>
  <!-- (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏ß‡πà‡∏ô‡∏à‡∏≤‡∏Å FA ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ)
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  -->
</head>
<body>

  <!-- Header -->
  <header class="sitebar">
    <div class="row">
      <div class="header-container" style="display:flex;align-items:center;gap:12px;width:100%;">
        <div class="logo"><img src="img/logo.png" alt="Bookstore Logo" /></div>

        <div class="search-bar" style="flex:1;display:flex;gap:8px;align-items:center;">
          <input type="text" placeholder="Search" aria-label="Search books" />
          <button aria-label="Search"><i class="fa-solid fa-magnifying-glass"></i></button>
        </div>

        <div class="header-cart">
          <a href="cart.html" class="cart" aria-label="Open cart">
            <img src="img/cart-icon.png" alt="" />
          </a>
        </div>

        <div class="header-profile">
          <a href="login.html" class="icon" aria-label="Login">
            <img src="img/BlankPF.png" alt="" />
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="container">
    <a class="crumb" href="#" onclick="goHome()">‚Üê Continue Shopping</a>
    <h2 class="title">My Cart</h2>

    <section class="grid">
      <!-- ‡∏ã‡πâ‡∏≤‡∏¢: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ -->
      <div>
        <div id="emptyState" style="display:none; color:var(--muted); padding:12px">
          Your cart is empty üï≥Ô∏è
        </div>

        <!-- ‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏à‡∏£‡∏¥‡∏á -->
        <div class="itemlist" id="cartList"></div>

        <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏£‡∏≠ (skeleton) -->
        <div id="placeholders">
          <div class="item skeleton">
            <div class="skel-thumb"></div>
            <div style="display:flex; flex-direction:column; gap:10px">
              <div class="skel" style="width:180px"></div>
              <div class="skel-sm" style="width:140px"></div>
              <div class="skel" style="width:80px; height:18px"></div>
            </div>
            <div style="display:flex; align-items:center;">
              <div class="skel-btn"></div>
            </div>
          </div>

          <div class="item skeleton">
            <div class="skel-thumb"></div>
            <div style="display:flex; flex-direction:column; gap:10px">
              <div class="skel" style="width:160px"></div>
              <div class="skel-sm" style="width:120px"></div>
              <div class="skel" style="width:60px; height:18px"></div>
            </div>
            <div style="display:flex; align-items:center;">
              <div class="skel-btn"></div>
            </div>
          </div>
        </div>

        <!-- ‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡∏Å‡∏≤‡∏£‡πå‡∏î 1 ‡πÉ‡∏ö (‡∏£‡∏≠‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) -->
        <template id="cart-item-tpl">
          <div class="item">
            <img class="thumb" src="" alt="book" />
            <div class="meta">
              <b class="title"></b>
              <small class="author"></small>
              <div class="price"></div>
            </div>
            <div style="display:flex; align-items:center; gap:8px">
              <div class="qty">
                <button type="button" class="btn-dec">‚àí</button>
                <span class="qty-num">1</span>
                <button type="button" class="btn-inc">+</button>
              </div>
              <button class="remove">Remove</button>
            </div>
          </div>
        </template>
      </div>

      <!-- ‡∏Ç‡∏ß‡∏≤: ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå -->
      <aside class="summary">
        <h3>Order Summary</h3>
        <div class="rows">
          <div class="rowline"><span>Subtotal</span><b id="subtotal">‡∏ø0</b></div>
          <div class="rowline"><span>Shipping Fee</span><span id="shipping">‡∏ø0</span></div>
          <div class="rowline"><span>Discount</span><span id="discount">-‡∏ø0</span></div>
          <div class="rowline total"><span>Total</span><b id="grandTotal">‡∏ø0</b></div>
        </div>
        <button class="checkout" onclick="checkout()">Go to Checkout</button>
      </aside>
    </section>

    <!-- ‡πÄ‡∏Å‡πá‡∏ö UI ‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏ß‡πâ (‡∏ã‡πà‡∏≠‡∏ô) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ JS ‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô/‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ -->
    <div aria-hidden="true" style="display:none">
      <h1>üõí My Shopping Cart</h1>
      <div id="userInfo"></div>
      <table id="cartTable">
        <thead>
          <tr>
            <th>Book Title</th><th>Author</th><th>Price</th>
            <th>Quantity</th><th>Subtotal</th><th>Action</th>
          </tr>
        </thead>
        <tbody id="cartBody"><tr><td colspan="6">Loading cart...</td></tr></tbody>
      </table>

      <p id="total">Total: $0.00</p>

      <button class="back-btn" onclick="goHome()">‚Üê Continue Shopping</button>
      <button class="checkout" onclick="checkout()">‚úÖ Checkout</button>
    </div>
  </main>

  <!-- Reference -->
  <footer class="reference">
    <div class="foot">
      <h3>Reference</h3>
      <div class="cols">
        <div>
          <h4>Genre:</h4>
          <ul>
            <li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li>
            <li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li>
          </ul>
        </div>
        <div>
          <h4>FAQ:</h4>
          <ul>
            <li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li>
            <li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li>
          </ul>
        </div>
        <div>
          <h4>Contact us:</h4>
          <ul>
            <li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li>
            <li style="display:flex; align-items:center; gap:8px">üìû <span>000-000-0000</span></li>
          </ul>
        </div>
      </div>
      <div class="brandline">‚Äú‡∏™‡πÇ‡∏•‡πÅ‡∏Å‡∏ô‚Äù ‚Ä¢ Power by BookStore.com</div>
    </div>
  </footer>

  <!-- Bottom Bar -->
  <div class="bottombar">
    <div class="barin">
      <div class="brand"><span class="book">üìö</span></div>
      <div class="copy">Power by BookStore.com</div>
      <div class="social">
        <a href="#" aria-label="YouTube">‚ñ∂Ô∏è</a>
        <a href="#" aria-label="Facebook">üìò</a>
        <a href="#" aria-label="Instagram">üì∑</a>
        <a href="#" aria-label="Mail">‚úâÔ∏è</a>
      </div>
    </div>
  </div>

    <script>
        const userId = localStorage.getItem("userId");
        const username = localStorage.getItem("username");
        const apiCart = "http://localhost:8080/api/cart";
        const apiOrders = "http://localhost:8080/api/orders";

       

        // ‚úÖ Load cart items
        function loadCart() {
            fetch(`${apiCart}/${userId}`)
                .then(res => res.json())
                .then(data => renderCart(data))
                .catch(err => console.error("Error loading cart:", err));
        }

        // ‚úÖ Render cart table
        function renderCart(items) {
            const body = document.getElementById("cartBody");
            body.innerHTML = "";
            let total = 0;

            if (items.length === 0) {
                body.innerHTML = `<tr><td colspan="6">Your cart is empty üï≥Ô∏è</td></tr>`;
                document.getElementById("total").innerText = "Total: $0.00";
                return;
            }

            items.forEach(item => {
                const subtotal = item.price * item.quantity;
                total += subtotal;

                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${item.title}</td>
                    <td>${item.author}</td>
                    <td>$${item.price.toFixed(2)}</td>
                    <td>${item.quantity}</td>
                    <td>$${subtotal.toFixed(2)}</td>
                    <td><button class="remove-btn" onclick="removeItem(${item.id})">Remove</button></td>
                `;
                body.appendChild(tr);
            });

            document.getElementById("total").innerText = `Total: $${total.toFixed(2)}`;
        }

        // ‚úÖ Remove item
        function removeItem(id) {
            if (!confirm("Remove this item from cart?")) return;
            fetch(`${apiCart}/remove/${id}`, { method: "DELETE" })
                .then(res => {
                    if (res.ok) loadCart();
                    else alert("‚ùå Failed to remove item");
                })
                .catch(err => console.error("Error removing item:", err));
        }

        // ‚úÖ Checkout
        function checkout() {
            if (!confirm("Proceed to checkout?")) return;

            fetch(`${apiOrders}/checkout/${userId}`, { method: "POST" })
                .then(res => res.text())
                .then(msg => {
                    alert(msg);
                    window.location.href = "checkout.html";
                })
                .catch(err => console.error("Error during checkout:", err));
        }

        // ‚úÖ Back to Home
        function goHome() {
            window.location.href = "index.html";
        }

        // üöÄ Load cart on page load
        loadCart();
    </script>
</body>
</html>
