<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="stylesheet.css" />
   <link rel="stylesheet" href="./cart.css">
    <title>üõí My Cart</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f4f4f4; }
        button {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .remove-btn {
            background-color: #e74c3c;
            color: white;
        }
        .remove-btn:hover { background-color: #c0392b; }
        .checkout-btn {
            background-color: #2ecc71;
            color: white;
            padding: 10px 15px;
            margin-top: 15px;
        }
        .checkout-btn:hover { background-color: #27ae60; }
        .back-btn {
            background-color: #3498db;
            color: white;
            padding: 8px 12px;
            margin-right: 10px;
        }
        .back-btn:hover { background-color: #2980b9; }
        #total { font-weight: bold; font-size: 18px; margin-top: 15px; }
    </style>
</head>
<body>

  <header class="sitebar">
    <div class="row">
      <div class="header-container">
            <div class="logo">
                <img src="img/logo.png" alt="Bookstore Logo">
            </div>
      <div class="search-bar">
                <input type="text" placeholder="Search" aria-label="Search books">
                <button aria-label="Search"><i class="fa-solid fa-magnifying-glass"></i></button>
            </div>
              <div class="header-cart">
                <a href="cart.html" class="cart" aria-label="Open cart">
                    <img src="img/cart-icon.png" alt="">
                </a>
            </div>
     
         <div class="header-profile">
                <a href="login.html" class="icon" aria-label="Login">
                    <img src="img/BlankPF.png" alt="">
                </a>
            </div>
    </div>
  </header>

  <main class="container">
    <a class="crumb" href="#" onclick="goHome()">‚Üê Continue Shopping</a>
    <h2 class="title">My Cart</h2>

    <section class="grid">
      <div>
        <div id="emptyState" style="display:none; color:var(--muted); padding:12px">Your cart is empty üï≥Ô∏è</div>
        <div class="itemlist" id="cartList"></div>
      </div>

      <aside class="summary">
        <h3>Order Summary</h3>
        <div class="rows">
          <div class="rowline"><span>Subtotal</span><b id="subtotal">‡∏ø0</b></div>
          <div class="rowline"><span>Shipping Fee</span><span id="shipping">‡∏ø0</span></div>
          <div class="rowline"><span>Discount</span><span id="discount">-‡∏ø0</span></div>
          <div class="rowline total"><span>Total</span><b id="grandTotal">‡∏ø0</b></div>
        </div>
        <button class="checkout" onclick="checkout()">Go to Checkout</button>
      </aside>
    </section>

    <details class="debug">
      <summary>üîß Original table UI (kept exactly, for debug)</summary>

      <h1>üõí My Shopping Cart</h1>
      <div id="userInfo"></div>

      <table id="cartTable">
        <thead>
          <tr>
            <th>Book Title</th>
            <th>Author</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Subtotal</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="cartBody">
          <tr><td colspan="6">Loading cart...</td></tr>
        </tbody>
      </table>

      <p id="total">Total: $0.00</p>

      <button class="back-btn" onclick="goHome()">‚Üê Continue Shopping</button>
      <button class="checkout" onclick="checkout()">‚úÖ Checkout</button>
    </details>
  </main>

 <!-- Reference section -->
<footer class="reference">
  <div class="foot">
    <h3>Reference</h3>
    <div class="cols">
      <div>
        <h4>Genre:</h4>
        <ul>
          <li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li>
          <li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li>
        </ul>
      </div>
      <div>
        <h4>FAQ:</h4>
        <ul>
          <li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li>
          <li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li>
        </ul>
      </div>
      <div>
        <h4>Contact us:</h4>
        <ul>
          <li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li><li>- xxxxxxxxxx</li>
          <li style="display:flex; align-items:center; gap:8px">üìû <span>000-000-0000</span></li>
        </ul>
      </div>
    </div>
    <div class="brandline">‚Äú‡∏™‡πÇ‡∏•‡πÅ‡∏Å‡∏ô‚Äù ‚Ä¢ Power by BookStore.com</div>
  </div>
</footer>

<!-- Bottom Bar -->
<div class="bottombar">
  <div class="barin">
    <div class="brand">
      <span class="book">üìö</span>
    </div>
    <div class="copy">Power by BookStore.com</div>
    <div class="social">
      <a href="#" aria-label="YouTube">‚ñ∂Ô∏è</a>
      <a href="#" aria-label="Facebook">üìò</a>
      <a href="#" aria-label="Instagram">üì∑</a>
      <a href="#" aria-label="Mail">‚úâÔ∏è</a>
    </div>
  </div>
</div>

    <script>
        const userId = localStorage.getItem("userId");
        const username = localStorage.getItem("username");
        const apiCart = "http://localhost:8080/api/cart";
        const apiOrders = "http://localhost:8080/api/orders";

       

        // ‚úÖ Load cart items
        function loadCart() {
            fetch(`${apiCart}/${userId}`)
                .then(res => res.json())
                .then(data => renderCart(data))
                .catch(err => console.error("Error loading cart:", err));
        }

        // ‚úÖ Render cart table
        function renderCart(items) {
            const body = document.getElementById("cartBody");
            body.innerHTML = "";
            let total = 0;

            if (items.length === 0) {
                body.innerHTML = `<tr><td colspan="6">Your cart is empty üï≥Ô∏è</td></tr>`;
                document.getElementById("total").innerText = "Total: $0.00";
                return;
            }

            items.forEach(item => {
                const subtotal = item.price * item.quantity;
                total += subtotal;

                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${item.title}</td>
                    <td>${item.author}</td>
                    <td>$${item.price.toFixed(2)}</td>
                    <td>${item.quantity}</td>
                    <td>$${subtotal.toFixed(2)}</td>
                    <td><button class="remove-btn" onclick="removeItem(${item.id})">Remove</button></td>
                `;
                body.appendChild(tr);
            });

            document.getElementById("total").innerText = `Total: $${total.toFixed(2)}`;
        }

        // ‚úÖ Remove item
        function removeItem(id) {
            if (!confirm("Remove this item from cart?")) return;
            fetch(`${apiCart}/remove/${id}`, { method: "DELETE" })
                .then(res => {
                    if (res.ok) loadCart();
                    else alert("‚ùå Failed to remove item");
                })
                .catch(err => console.error("Error removing item:", err));
        }

        // ‚úÖ Checkout
        function checkout() {
            if (!confirm("Proceed to checkout?")) return;

            fetch(`${apiOrders}/checkout/${userId}`, { method: "POST" })
                .then(res => res.text())
                .then(msg => {
                    alert(msg);
                    window.location.href = "checkout.html";
                })
                .catch(err => console.error("Error during checkout:", err));
        }

        // ‚úÖ Back to Home
        function goHome() {
            window.location.href = "home.html";
        }

        // üöÄ Load cart on page load
        loadCart();
    </script>
</body>
</html>
